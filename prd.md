# 小说章节自动分割与编辑器 - 产品需求文档

## 1. 产品概述
开发一个Web应用程序，帮助作者自动分割小说章节并提供手动编辑功能，支持章节分割、合并等操作。

## 2. 核心功能需求

### 2.1 文件导入功能
**任务1：文件上传组件**
- 实现文件拖拽上传或文件选择功能
- 支持.txt格式文件
- 添加文件大小和格式验证
- 显示上传进度和状态

### 2.2 自动章节分割功能
**任务2：章节识别算法**
- 实现多种章节格式识别：
  - 数字格式：Chapter 1, Chapter 2
  - 英文格式：Chapter One, Chapter Two  
  - 罗马数字：Chapter I, Chapter II
  - 中文格式：第一章，第二章
  - 带标题格式：Chapter 1 - Title, Chapter Five - Title
- 支持章节标题提取功能
- 处理不规范的章节分割标记

**任务3：文本预处理**
- 移除多余空行和格式化字符
- 标准化文本编码
- 处理特殊字符和符号

### 2.3 用户界面开发
**任务4：章节列表组件**
- 显示自动分割后的章节列表
- 章节缩略内容预览
- 当前编辑章节高亮显示
- 章节状态标识（编辑中、已完成等）

**任务5：文本编辑器组件**
- 大文本区域的文本编辑器
- 支持光标定位和文本选择
- 实时保存功能
- 撤销/重做功能

**任务6：工具栏组件**
- 文件导入按钮
- 章节分割按钮
- 章节合并按钮
- 保存/导出按钮

### 2.4 章节分割功能
**任务7：手动分割标记插入**
- 在光标位置插入分割标记：`====SPLIT CHAPTER====`
- 支持在单个章节中插入多个分割标记
- 分割标记的可视化显示

**任务8：章节分割执行**
- 根据分割标记将章节拆分为多个新章节
- 自动生成新章节标题
- 更新章节列表显示
- 保持文本内容完整性

### 2.5 章节合并功能
**任务9：章节合并逻辑**
- 将当前章节与下一章节合并
- 保留当前章节标题
- 合并后更新章节列表
- 支持撤销合并操作

### 2.6 数据管理
**任务10：状态管理**
- 实现全局状态管理（使用Context API或Zustand）
- 章节数据结构设计
- 编辑历史记录管理

**任务11：数据持久化**
- 本地存储当前编辑状态
- 导出编辑后的文本文件
- 支持项目保存和加载

### 2.7 增强功能
**任务12：智能章节标题生成**
- 基于章节内容自动生成标题建议
- 支持用户自定义章节标题
- 标题格式标准化

**任务13：批量操作**
- 批量章节重命名
- 批量章节删除
- 章节顺序调整（拖拽排序）

## 3. 技术实现任务

### 3.1 前端架构
**任务14：项目结构优化**
- 基于现有Next.js项目扩展
- 组件模块化设计
- 类型定义和接口设计

**任务15：UI库集成优化**
- 优化NextUI组件使用
- 自定义主题配置
- 响应式设计实现

### 3.2 核心算法
**任务16：文本解析引擎**
- 正则表达式模式匹配
- 文本分词和结构化分析
- 错误处理和边界情况处理

**任务17：性能优化**
- 大文件处理优化
- 虚拟滚动实现
- 内存管理优化

### 3.3 测试与验证
**任务18：单元测试**
- 章节识别算法测试
- 文本处理函数测试
- 组件功能测试

**任务19：集成测试**
- 端到端流程测试
- 多种文本格式兼容性测试
- 性能基准测试

## 4. 开发优先级

**第一阶段（核心功能）：**
- 任务1：文件上传组件
- 任务2：章节识别算法
- 任务4：章节列表组件
- 任务5：文本编辑器组件

**第二阶段（编辑功能）：**
- 任务7：手动分割标记插入
- 任务8：章节分割执行
- 任务9：章节合并逻辑
- 任务10：状态管理

**第三阶段（增强功能）：**
- 任务11：数据持久化
- 任务12：智能章节标题生成
- 任务16：文本解析引擎优化

**第四阶段（优化测试）：**
- 任务17：性能优化
- 任务18-19：测试覆盖

## 5. 验收标准
- 能够成功识别并分割提供的示例文本文件
- 支持手动章节分割和合并操作
- 界面友好，操作流畅
- 支持大文件处理（>1MB）
- 兼容多种章节格式